<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç›²ç›’æ”¶ç›Šè®¡ç®—å™¨ V3.8</title>
    <style>
        :root {
            --bg: #050505;
            --card-bg: #141414;
            --primary: #00f2ea;
            --gold: #ffd700;
            --fuel: #ff3b30;
            --team: #bf5af2;
            --text-main: #ffffff;
            --text-sub: #888888;
            --border: rgba(255,255,255,0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", Roboto, sans-serif; }
        
        body { background-color: var(--bg); color: var(--text-main); padding: 15px; max-width: 600px; margin: 0 auto; min-height: 100vh; padding-bottom: 90px; }

        header { text-align: center; margin-bottom: 20px; padding: 15px 0; border-bottom: 1px solid var(--border); }
        header h1 { font-size: 20px; font-weight: 800; background: linear-gradient(90deg, #fff, var(--primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        header p { font-size: 11px; color: var(--text-sub); margin-top: 5px; }

        /* é€‰é¡¹å¡ */
        .tabs { display: flex; background: #222; border-radius: 8px; padding: 4px; margin-bottom: 15px; }
        .tab-btn { flex: 1; text-align: center; padding: 10px; font-size: 13px; color: #666; cursor: pointer; border-radius: 6px; transition: 0.3s; font-weight: bold; }
        .tab-btn.active { background: var(--card-bg); color: var(--primary); box-shadow: 0 2px 8px rgba(0,0,0,0.4); }
        .tab-btn.active.team { color: var(--team); }

        .panel { display: none; }
        .panel.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* å¡ç‰‡å®¹å™¨ */
        .card { background: var(--card-bg); border-radius: 12px; padding: 16px; margin-bottom: 12px; border: 1px solid var(--border); position: relative; }
        .card-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .card-title { font-size: 13px; font-weight: bold; color: var(--primary); display: flex; align-items: center; gap: 5px; }
        .card-title.team { color: var(--team); }

        /* è¾“å…¥æ§ä»¶ */
        .input-group { margin-bottom: 15px; }
        .label-row { display: flex; justify-content: space-between; font-size: 12px; color: var(--text-sub); margin-bottom: 6px; }
        .input-wrap { position: relative; }
        input[type="number"] { width: 100%; background: #000; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 6px; font-size: 16px; font-weight: bold; outline: none; transition: border-color 0.3s; }
        input[type="number"]:focus { border-color: var(--primary); }
        .unit { position: absolute; right: 12px; top: 14px; font-size: 12px; color: #666; }
        
        #team input[type="number"]:focus { border-color: var(--team); }

        input[type=range] { width: 100%; -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: var(--primary); margin-top: -6px; box-shadow: 0 0 10px rgba(0,242,234,0.3); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: #333; border-radius: 2px; }
        
        /* æ³¢æ¯”è°ƒèŠ‚æ»‘å—é¢œè‰² */
        #p_reward_rate::-webkit-slider-thumb { background: var(--gold); box-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
        
        /* å›¢é˜Ÿæ»‘å—é¢œè‰² */
        #t_invite::-webkit-slider-thumb { background: var(--team); box-shadow: 0 0 10px rgba(191,90,242,0.5); }

        /* ç»“æœå±•ç¤º */
        .income-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .income-box { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; text-align: center; }
        .income-val { font-size: 20px; font-weight: 800; margin-bottom: 4px; }
        .income-lbl { font-size: 10px; color: #888; }
        .val-cash { color: var(--primary); }
        .val-point { color: var(--gold); }

        /* è´¦å•æ¡ç›® */
        .bill-row { display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 6px; padding-bottom: 6px; border-bottom: 1px dashed #222; }
        .bill-row:last-child { border: none; margin: 0; padding: 0; }
        .bill-key { color: #888; }
        .bill-val { font-weight: bold; }
        .bill-val.green { color: var(--primary); }
        .bill-val.red { color: var(--fuel); }
        .bill-val.gold { color: var(--gold); }
        .bill-val.team { color: var(--team); }

        /* ä»£ç†æç¤ºæ¡† */
        .agent-hint {
            display: none;
            background: rgba(191, 90, 242, 0.15);
            border: 1px solid rgba(191, 90, 242, 0.4);
            border-radius: 8px;
            padding: 10px;
            margin-top: 15px;
            font-size: 11px;
            color: #e0e0e0;
            line-height: 1.5;
            cursor: pointer;
            animation: pulse 2s infinite;
        }
        .agent-hint strong { color: var(--team); font-weight: bold; }
        .agent-hint::after { content: " â†’"; }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(191, 90, 242, 0.2); }
            70% { box-shadow: 0 0 0 6px rgba(191, 90, 242, 0); }
            100% { box-shadow: 0 0 0 0 rgba(191, 90, 242, 0); }
        }

        /* çŠ¶æ€æ  */
        .status-bar { background: rgba(0,0,0,0.3); padding: 8px 12px; border-radius: 6px; margin-top: 10px; display: flex; justify-content: space-between; align-items: center; font-size: 10px; }
        .status-item { display: flex; align-items: center; gap: 4px; color: #666; }
        .dot { width: 6px; height: 6px; border-radius: 50%; background: #444; }
        .dot.ok { background: var(--primary); box-shadow: 0 0 5px var(--primary); }
        .status-item.ok { color: var(--primary); }

        /* åº•éƒ¨æ±‡æ€» */
        .footer { position: fixed; bottom: 0; left: 0; right: 0; background: #111; border-top: 1px solid #333; padding: 12px 20px; max-width: 600px; margin: 0 auto; z-index: 100; display: flex; justify-content: space-between; align-items: center; }
        .foot-total span { display: block; font-size: 10px; color: #666; }
        .foot-total b { font-size: 22px; color: #fff; }
        .foot-roi { background: rgba(0,242,234,0.15); color: var(--primary); padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; }
    </style>
</head>
<body>

<header>
    <h1>ç›²ç›’æ”¶ç›Šè®¡ç®—å™¨ V3.7</h1>
    <p>æ³¢æ¯”çµæ´»å¯è°ƒ Â· é€‚åº”å¸‚åœºå˜åŒ–</p>
</header>

<div class="tabs">
    <div class="tab-btn active" id="tab_p" onclick="switchTab('personal', this)">ğŸ‘¤ ä¸ªäººæ”¶ç›Š</div>
    <div class="tab-btn" id="tab_t" onclick="switchTab('team', this)">ğŸš€ å›¢é˜Ÿä»£ç†</div>
</div>

<div id="personal" class="panel active">
    
    <div class="card">
        <div class="card-head"><span class="card-title">âš™ï¸ æŠ•èµ„å‚æ•°</span></div>
        <div class="input-group">
            <div class="label-row"><span>å•æ¬¡æŠ•å…¥æœ¬é‡‘</span> <span>1000 èµ·æŠ•ï¼Œ1000å€æ•°</span></div>
            <div class="input-wrap">
                <input type="number" id="p_principal" value="10000" min="1000" step="1000" oninput="calc()">
                <span class="unit">å…ƒ</span>
            </div>
        </div>
        
        <div class="input-group">
            <div class="label-row">
                <span>è¿”åˆ©æ³¢æ¯” (å¸‚åœºåŠ¨æ€è°ƒæ•´)</span> 
                <span id="reward_rate_txt" style="color:var(--gold)">3.0%</span>
            </div>
            <input type="range" id="p_reward_rate" min="2.0" max="3.0" step="0.1" value="3.0" oninput="calc()">
            <div class="label-row" style="margin-top:5px;">
                <span style="font-size:9px; color:#666;">*æ‹†è§£: 70%é‡‘è±† + 30%é“¶è±†</span>
                <span id="split_detail" style="font-size:9px; color:#888;">é‡‘è±†2.1% | é“¶è±†0.9%</span>
            </div>
        </div>

        <div class="input-group">
            <div class="label-row"><span>æŠ•èµ„æ—¶é•¿ (48å°æ—¶/è½®)</span> <span id="p_time_txt" style="color:var(--primary)">6ä¸ªæœˆ</span></div>
            <input type="range" id="p_time" min="1" max="12" value="6" step="1" oninput="calc()">
        </div>
        <div class="input-group" style="display:flex; justify-content:space-between; align-items:center; border-top:1px dashed #333; padding-top:10px;">
            <span style="font-size:12px; color:#aaa;">å¼€å¯å¤åˆ© (é‡‘è±†åˆ©æ¶¦æ»šå…¥æœ¬é‡‘)</span>
            <input type="checkbox" id="p_compound" checked onchange="calc()" style="width:18px; height:18px;">
        </div>
    </div>

    <div class="card">
        <div class="card-head">
            <span class="card-title">ğŸ“‰ æç°è´¹ç‡ & ç›´æ¨</span>
            <span id="fee_display" style="font-size:11px; background:#333; padding:2px 6px; border-radius:4px;">15%</span>
        </div>
        <div class="input-group">
            <div class="label-row"><span>ç›´æ¨å¥½å‹äººæ•° (åŒæ­¥å›¢é˜Ÿæ•°æ®)</span> <span id="invite_txt" style="color:var(--primary)">0 äºº</span></div>
            <input type="range" id="invite" min="0" max="1000" value="0" step="1" oninput="syncInvite(this.value)">
            <p style="font-size:10px; color:#666; margin-top:5px;">*æ‹‰æ»¡4äººè´¹ç‡é™è‡³3%</p>
        </div>

        <div id="agent_hint" class="agent-hint" onclick="switchTab('team', document.getElementById('tab_t'))">
            ğŸ‰ <strong>æ­å–œï¼ç›´æ¨å·²è¾¾æ ‡</strong><br>
            æ‚¨å¯èƒ½å·²è§¦å‘ã€V1å›¢é˜Ÿä»£ç†ã€‘èµ„æ ¼ï¼Œç‚¹å‡»æ­¤å¤„å‰å¾€æŸ¥çœ‹å›¢é˜Ÿç®¡é“æ”¶ç›Šï¼
        </div>
    </div>

    <div class="income-grid">
        <div class="income-box">
            <div class="income-val val-cash" id="res_net_cash">0</div>
            <div class="income-lbl">é‡‘è±†å‡€åˆ©æ¶¦ (ç¨å)</div>
        </div>
        <div class="income-box">
            <div class="income-val val-point" id="res_points">0</div>
            <div class="income-lbl">è´­ç‰©é“¶è±†ä»·å€¼ (0.9%)</div>
        </div>
    </div>

    <div class="card">
        <div class="card-head"><span class="card-title">ğŸ§¾ æ”¶ç›Šæ„æˆæ˜ç»†</span></div>
        <div class="bill-row">
            <span class="bill-key">ğŸ’° é‡‘è±†æ€»äº§å‡º</span>
            <span class="bill-val green" id="bill_gross_cash">+0</span>
        </div>
        <div class="bill-row">
            <span class="bill-key">ğŸ é“¶è±†æ€»äº§å‡º</span>
            <span class="bill-val gold" id="bill_gross_point">+0</span>
        </div>
        <div class="bill-row">
            <span class="bill-key">ğŸ”¥ ç‡ƒæ–™è´¹æ¶ˆè€— (æœ¬é‡‘Ã—0.5%)</span>
            <span class="bill-val red" id="bill_fuel">-0</span>
        </div>
        <div class="bill-row">
            <span class="bill-key">ğŸ¦ æç°æ‰‹ç»­è´¹ (ä»…æ‰£é‡‘è±†éƒ¨åˆ†)</span>
            <span class="bill-val red" id="bill_tax">-0</span>
        </div>
        <div class="bill-row" style="margin-top:5px; border-top:1px solid #333; padding-top:5px;">
            <span class="bill-key" style="color:#fff;">ğŸ“Š å®é™…å‡€èµšä»·å€¼</span>
            <span class="bill-val" style="color:#fff;" id="bill_total_net">+0</span>
        </div>
    </div>
</div>

<div id="team" class="panel">
    <div class="card" style="border-color: rgba(191,90,242,0.3);">
        <div class="card-head">
            <span class="card-title team">ğŸ’ å›¢é˜Ÿç®¡é“æ”¶ç›Š</span>
            <span id="t_level_badge" style="background:#333; font-size:10px; padding:2px 6px; border-radius:4px; color:#888;">V0</span>
        </div>
        
        <div class="input-group">
            <div class="label-row"><span>ç›´æ¨äººæ•° (åŒæ­¥ä¸ªäººæ•°æ®)</span> <span id="t_invite_txt" style="color:var(--team)">0 äºº</span></div>
            <input type="range" id="t_invite" min="0" max="1000" value="0" step="1" oninput="syncInvite(this.value)">
        </div>

        <div class="input-group">
            <div class="label-row"><span>ç›´æ¨å¥½å‹äººå‡æŠ•å…¥ (è‡ªåŠ¨ç®—æµæ°´)</span> <span>å¯è°ƒæ•´</span></div>
            <div class="input-wrap">
                <input type="number" id="t_avg_invest" value="10000" oninput="autoCalcVol()">
                <span class="unit">å…ƒ/äºº</span>
            </div>
        </div>

        <div class="input-group">
            <div class="label-row"><span>ç›´æ¨æ€»æµæ°´/è½® (è‡ªåŠ¨è®¡ç®—)</span> <span>0.45% å¥–åŠ±</span></div>
            <div class="input-wrap">
                <input type="number" id="t_direct_vol" value="0" placeholder="0" oninput="calc()">
                <span class="unit">å…ƒ</span>
            </div>
        </div>

        <div class="input-group">
            <div class="label-row"><span>å›¢é˜Ÿæ€»æµæ°´/è½® (å«ç›´æ¨)</span> <span>V1éœ€â‰¥10ä¸‡</span></div>
            <div class="input-wrap">
                <input type="number" id="t_team_vol" value="0" placeholder="0" oninput="calc()">
            </div>
        </div>

        <div class="status-bar">
            <span style="color:#888;">å‡çº§ V1 æ¡ä»¶:</span>
            <div class="status-item" id="check_people">
                <div class="dot"></div> ç›´æ¨â‰¥5äºº
            </div>
            <div class="status-item" id="check_vol">
                <div class="dot"></div> æµæ°´â‰¥10ä¸‡
            </div>
        </div>

        <div id="peer_box" style="display:none; border-top:1px dashed #333; padding-top:10px; margin-top:10px;">
            <div class="label-row"><span>å¹³çº§ä¸‹å±æ€»æ”¶å…¥</span> <span>10% ä¼¯ä¹å¥–</span></div>
            <div class="input-wrap">
                <input type="number" id="t_peer_income" value="0" placeholder="0" oninput="calc()">
            </div>
        </div>

        <div class="bill-row" style="margin-top:15px;">
            <span class="bill-key">ç›´æ¨æµæ°´å¥– (æŒç»­ç´¯ç§¯)</span>
            <span class="bill-val team" id="res_direct_award">+0</span>
        </div>
        <div class="bill-row">
            <span class="bill-key">å›¢é˜Ÿçº§å·®å¥– (éœ€è¾¾æ ‡)</span>
            <span class="bill-val team" id="res_team_award">+0</span>
        </div>
    </div>
</div>

<div class="footer">
    <div class="foot-total">
        <span>èµ„äº§æ€»ä»·å€¼ (é‡‘è±†+é“¶è±†+å›¢é˜Ÿ)</span>
        <b id="final_asset">Â¥ 0</b>
    </div>
    <div class="foot-roi" id="final_roi">ROI: 0%</div>
</div>

<script>
    const CONFIG = {
        cycle: 15,            
        fuelRatio: 0.005,     
        directRatio: 0.0045,
        minUnit: 1000 
    };

    const LEVELS = [
        { n:'V0', r:0, d:0 },
        { n:'V1', r:0.0015, d:5 },
        { n:'V2', r:0.0030, d:6 },
        { n:'V3', r:0.0045, d:7 },
        { n:'V4', r:0.0055, d:8 },
        { n:'V5', r:0.0065, d:9 }
    ];

    const $ = id => document.getElementById(id);
    const fmt = n => Math.floor(n).toLocaleString();

    function switchTab(mode, el) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        $(mode).classList.add('active');
    }

    function syncInvite(val) {
        let v = parseInt(val);
        $('t_invite').value = v;
        $('invite').value = v; 
        autoCalcVol();
    }

    function autoCalcVol() {
        let invites = parseInt($('invite').value) || 0;
        let avgInvest = parseFloat($('t_avg_invest').value) || 0;
        $('t_direct_vol').value = invites * avgInvest;
        let teamVol = parseFloat($('t_team_vol').value) || 0;
        if (teamVol < (invites * avgInvest)) {
            $('t_team_vol').value = invites * avgInvest;
        }
        calc();
    }

    function calc() {
        // --- 1. è·å–è¾“å…¥ ---
        let principal = parseFloat($('p_principal').value) || 0;
        let months = parseInt($('p_time').value);
        let invites = parseInt($('invite').value);
        let isCompound = $('p_compound').checked;
        let rounds = months * CONFIG.cycle;

        // --- æ³¢æ¯”è®¡ç®— ---
        let totalRewardRate = parseFloat($('p_reward_rate').value) / 100;
        $('reward_rate_txt').innerText = (totalRewardRate * 100).toFixed(1) + "%";
        
        let cashRatio = totalRewardRate * 0.70;
        let pointRatio = totalRewardRate * 0.30;
        
        $('split_detail').innerText = `é‡‘è±†${(cashRatio*100).toFixed(2)}% | é“¶è±†${(pointRatio*100).toFixed(2)}%`;

        // UI æ–‡æœ¬æ›´æ–°
        $('p_time_txt').innerText = months + " ä¸ªæœˆ";
        $('invite_txt').innerText = invites + " äºº";
        $('t_invite_txt').innerText = invites + " äºº";

        if (invites >= 5) {
            $('agent_hint').style.display = 'block';
        } else {
            $('agent_hint').style.display = 'none';
        }

        // --- 2. ä¸ªäººè´¹ç‡è®¡ç®— ---
        let feeUserCount = invites > 4 ? 4 : invites;
        let taxRate = 0.15 - (feeUserCount * 0.03);
        if(taxRate < 0.03) taxRate = 0.03;
        
        $('fee_display').innerText = `è´¹ç‡: ${(taxRate*100).toFixed(0)}%`;
        $('fee_display').style.color = taxRate === 0.03 ? '#00f2ea' : '#fff';

        // --- 3. ä¸ªäººæ”¶ç›Šè®¡ç®— (ä¸¥è°¨ä¿®æ­£) ---
        let balance = principal;
        let totalCashGross = 0; // é‡‘è±†æ€»äº§å‡º
        let totalFuelPaid = 0;  // ç‡ƒæ–™è´¹
        let totalPoints = 0;    // é“¶è±†æ€»äº§å‡º

        for(let i=0; i<rounds; i++) {
            let effectivePrincipal = 0;
            if (isCompound) {
                effectivePrincipal = Math.floor(balance / CONFIG.minUnit) * CONFIG.minUnit;
            } else {
                effectivePrincipal = Math.floor(principal / CONFIG.minUnit) * CONFIG.minUnit;
            }

            if (effectivePrincipal < CONFIG.minUnit) effectivePrincipal = 0;

            let roundCash = effectivePrincipal * cashRatio;
            let roundPoint = effectivePrincipal * pointRatio;
            let roundFuel = effectivePrincipal * CONFIG.fuelRatio;

            totalCashGross += roundCash;
            totalPoints += roundPoint;
            totalFuelPaid += roundFuel;

            let roundNetCash = roundCash - roundFuel;
            if(isCompound) balance += roundNetCash;
        }

        // --- ä¿®æ­£åçš„ç¨è´¹é€»è¾‘ï¼šå…ˆç®—æ¯›åˆ©ç¨ï¼Œå†æ‰£ç‡ƒæ–™ ---
        // é€»è¾‘ï¼šæç°ç¨è´¹æ˜¯åŸºäº"é‡‘è±†æ”¶ç›Šæ€»é¢"è®¡ç®—çš„ï¼Œç‡ƒæ–™è´¹æ˜¯å¦å¤–çš„æ²‰æ²¡æˆæœ¬ã€‚
        // è®¡ç®—é‡‘è±†æ¯›åˆ©ï¼ˆCompoundæ¨¡å¼ä¸‹ä¸ºå¢å€¼éƒ¨åˆ†+ç‡ƒæ–™æ¶ˆè€—å›å¡«ï¼ŒSimpleæ¨¡å¼ä¸‹å³ä¸ºæ€»äº§å‡ºï¼‰
        // è¿™é‡Œä¸ºäº†ç®€åŒ–ä¸”å‡†ç¡®ï¼šæç°åŸºç¡€ = é‡‘è±†æ€»äº§å‡ºã€‚
        // æ³¨æ„ï¼šé€šå¸¸æœ¬é‡‘æç°ä¸æ”¶æ‰‹ç»­è´¹ï¼ˆæˆ–è§„åˆ™å¦ç®—ï¼‰ï¼Œè¿™é‡Œåªç®—â€œæ”¶ç›Šâ€çš„æ‰‹ç»­è´¹ã€‚
        
        let taxFee = totalCashGross * taxRate; // é’ˆå¯¹é‡‘è±†æ€»äº§å‡ºæ”¶ç¨
        
        // å‡€åˆ©æ¶¦ = é‡‘è±†æ€»äº§å‡º - ç¨è´¹ - ç‡ƒæ–™è´¹
        let netCashProfit = totalCashGross - taxFee - totalFuelPaid;

        $('res_net_cash').innerText = "Â¥ " + fmt(netCashProfit);
        $('res_points').innerText = fmt(totalPoints);
        $('bill_gross_cash').innerText = "+" + fmt(totalCashGross);
        $('bill_gross_point').innerText = "+" + fmt(totalPoints);
        $('bill_fuel').innerText = "-" + fmt(totalFuelPaid);
        $('bill_tax').innerText = "-" + fmt(taxFee);
        $('bill_total_net').innerText = "+" + fmt(netCashProfit + totalPoints);

        // --- 4. å›¢é˜Ÿè®¡ç®— ---
        let directVol = parseFloat($('t_direct_vol').value) || 0;
        let teamVol = parseFloat($('t_team_vol').value) || 0;
        let peerIncome = parseFloat($('t_peer_income').value) || 0;

        let directBonus = directVol * CONFIG.directRatio * rounds;
        $('res_direct_award').innerText = "+" + fmt(directBonus);

        let isInviteOk = invites >= 5;
        let isVolOk = teamVol >= 100000;

        if(isInviteOk) {
            $('check_people').classList.add('ok');
            $('check_people').querySelector('.dot').classList.add('ok');
        } else {
            $('check_people').classList.remove('ok');
            $('check_people').querySelector('.dot').classList.remove('ok');
        }
        
        if(isVolOk) {
            $('check_vol').classList.add('ok');
            $('check_vol').querySelector('.dot').classList.add('ok');
        } else {
            $('check_vol').classList.remove('ok');
            $('check_vol').querySelector('.dot').classList.remove('ok');
        }

        let curLvl = LEVELS[0];
        if (isInviteOk && isVolOk) {
            for(let l of LEVELS) {
                if(invites >= l.d) curLvl = l;
            }
        }

        $('t_level_badge').innerText = curLvl.n;
        $('t_level_badge').style.color = curLvl.n === 'V0' ? '#888' : '#bf5af2';
        $('peer_box').style.display = curLvl.n >= 'V3' ? 'block' : 'none';

        let teamBonus = teamVol * curLvl.r * rounds;
        let peerBonus = (curLvl.n >= 'V3') ? (peerIncome * 0.1) : 0;
        let totalTeamBonus = teamBonus + peerBonus;

        $('res_team_award').innerText = "+" + fmt(totalTeamBonus);

        // --- 5. æ±‡æ€» ---
        // èµ„äº§æ€»ä»·å€¼ = æœ¬é‡‘ + é‡‘è±†å‡€åˆ© + é“¶è±† + å›¢é˜Ÿ
        let finalAsset = principal + netCashProfit + totalPoints + directBonus + totalTeamBonus;
        let totalYield = finalAsset - principal;
        let roi = principal > 0 ? ((totalYield / principal) * 100) : 0;

        $('final_asset').innerText = "Â¥ " + fmt(finalAsset);
        $('final_roi').innerText = "ROI: " + roi.toFixed(0) + "%";
    }

    // åˆå§‹åŒ–
    calc();

</script>
</body>
</html>
